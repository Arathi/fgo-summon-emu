<!DOCTYPE HTML>
<html>
    <head>
        <title>FGO抽卡模拟器</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" />
    </head>
    <body>
        <div class="container">
            <div class="row">
                <div class="col-md-12"><b>FGO抽卡模拟器</b></div>
            </div>
            <div class="row">
                <div class="col-md-4">圣晶石剩余量：<span id="saint_quartz"></span></div>
                <div class="col-md-2"><button id="btn-buy-518" class="btn btn-default">氪一单</button></div>
                <div class="col-md-2"><button id="btn-buy-5180" class="btn btn-default">氪十单</button></div>
                <div class="col-md-4">人民币消耗量：<span id="rmb_cost"></span></div>
            </div>
            <div class="row">
                <div class="col-md-12">
                    <canvas id="cards-canvas" width="1016" height="574">
                        当前浏览器不支持&lt;canvas&gt;标签
                    </canvas>
                </div>
            </div>
            <div class="row">
                <div class="col-md-3"></div>
                <div class="col-md-3"><button id="btn-draw-once" class="btn btn-default">召唤一次</button></div>
                <div class="col-md-3"><button id="btn-draw-timesten" class="btn btn-default">召唤十次</button></div>
            </div>
            <div class="row">
                出货历史：<span id="summon_counter"></span>
            </div>

            <div class="row">SSR从者<span id="p_servant_ssr"></span></div>
            <div class="row" id="servant_ssr_list">
                
            </div>

            <div class="row">SSR礼装<span id="p_craft_essence_ssr"></span></div>
            <div class="row" id="craft_essence_ssr_list">
                
            </div>

            <div class="row">SR从者<span id="p_servant_sr"></span></div>
            <div class="row" id="servant_sr_list">
                
            </div>
            
            <div class="row">SR礼装<span id="p_craft_essence_sr"></span></div>
            <div class="row" id="craft_essence_sr_list">
                
            </div>

            <div class="row">
                <img id="background" src="img/background.png" style="display:none"/>
            </div>
        </div>

        <script src="https://code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script>
        <script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

        <script type="text/javascript" src="js/data.js"></script>
        <script type="text/javascript" src="js/core.js"></script>
        <script type="text/javascript" src="js/drawing.js"></script>

        <script type="text/javascript">
            function updateProbability() {
                var rate;

                rate = 100 * $('#servant_ssr_list').children().length / window.summonCounter;
                $('span#p_servant_ssr').text("（出货率：" + rate + "%）");

                rate = 100 * $('#craft_essence_ssr_list').children().length / window.summonCounter;
                $('span#p_craft_essence_ssr').text("（出货率：" + rate + "%）");

                rate = 100 * $('#servant_sr_list').children().length / window.summonCounter;
                $('span#p_servant_sr').text("（出货率：" + rate + "%）");

                rate = 100 * $('#craft_essence_sr_list').children().length / window.summonCounter;
                $('span#p_craft_essence_sr').text("（出货率：" + rate + "%）");
            }

            $('#btn-buy-518').click(function() {
                window.saintQuartz += 140;
                $('span#saint_quartz').text(window.saintQuartz);
                window.rmbCost += 518;
                $('span#rmb_cost').text(window.rmbCost);
            });

            $('#btn-buy-5180').click(function() {
                window.saintQuartz += 1400;
                $('span#saint_quartz').text(window.saintQuartz);
                window.rmbCost += 5180;
                $('span#rmb_cost').text(window.rmbCost);
            });

            $('#btn-draw-once').click(function(){
                if (window.saintQuartz < 3) {
                    alert("圣晶石不足！");
                    return;
                }
                window.saintQuartz -= 3;
                $('span#saint_quartz').text(window.saintQuartz);
                window.summonCounter += 1;
                $('span#summon_counter').text(window.summonCounter);

                var card = summon(window.pool);
                drawOnce(card);

                updateProbability();
            });

            $('#btn-draw-timesten').click(function(){
                if (window.saintQuartz < 30) {
                    alert("圣晶石不足！");
                    return;
                }
                window.saintQuartz -= 30;
                $('span#saint_quartz').text(window.saintQuartz);
                window.summonCounter += 10;
                $('span#summon_counter').text(window.summonCounter);

                var cards = summon10combo(window.pool);

                for (var i=0; i<cards.length; i++)
                {
                    var x = Math.floor(i % 6);
                    var y = Math.floor(i / 6);
                    if (y == 1) x += 1;
                    var card = cards[i];
                    drawCombo(card, x, y);
                }

                updateProbability();
            });

            $().ready(function(){
                var c = $("canvas#cards-canvas")[0];
                var ctx = c.getContext("2d");
                window.imgBg = new Image();
                window.imgBg.src = "img/background.png";
                window.summonCounter = 0;
                window.saintQuartz = 0;
                window.rmbCost = 0;
                window.pool = data.pools.event_20160411;

                $('span#saint_quartz').text(window.saintQuartz);
                imgBg.onload = function() {
                    ctx.drawImage(window.imgBg, 0, 0);
                }
            });
        </script>
    </body>
</html>
